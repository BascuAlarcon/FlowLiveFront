<!-- Tabla: Productos M치s Vendidos -->
<div class="card mb-4" *ngIf="livestreamData">
    <div class="card-body">
        <h2 class="card-title mb-3">Productos M치s Vendidos</h2>
        
        <div *ngIf="livestreamData.topProducts.length === 0" style="text-align: center; padding: 2em; color: #6C757D;">
            No hay productos vendidos a칰n.
        </div>
        
        <div *ngIf="livestreamData.topProducts.length > 0" style="overflow-x: auto;">
            <table class="table" style="min-width: 700px;">
                <thead style="background-color: #f8f9fa;">
                    <tr>
                        <th style="padding: 1em; border-bottom: 2px solid #dee2e6; width: 100px;">Imagen</th>
                        <th style="padding: 1em; border-bottom: 2px solid #dee2e6;">Categor칤a</th>
                        <th style="padding: 1em; border-bottom: 2px solid #dee2e6; text-align: right;">Precio</th>
                        <th style="padding: 1em; border-bottom: 2px solid #dee2e6; text-align: center;">Cantidad</th>
                        <th style="padding: 1em; border-bottom: 2px solid #dee2e6; text-align: right;">Revenue Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let product of livestreamData.topProducts.slice(0, 10); let i = index">
                        <td style="padding: 1em; border-bottom: 1px solid #dee2e6;">
                            <img *ngIf="product.imageUrl" 
                                 [src]="product.imageUrl" 
                                 alt="{{product.categoryName}}"
                                 style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;">
                            <div *ngIf="!product.imageUrl" 
                                 style="width: 60px; height: 60px; background-color: #e9ecef; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                                游닍
                            </div>
                        </td>
                        <td style="padding: 1em; border-bottom: 1px solid #dee2e6;">
                            <div style="font-weight: 600; color: #1D2345;">{{product.categoryName}}</div>
                        </td>
                        <td style="padding: 1em; border-bottom: 1px solid #dee2e6; text-align: right;">
                            {{formatCurrency(product.price)}}
                        </td>
                        <td style="padding: 1em; border-bottom: 1px solid #dee2e6; text-align: center;">
                            <span style="background-color: #667eea; color: white; padding: 0.25em 0.75em; border-radius: 12px; font-weight: 600;">
                                {{formatNumber(product.quantity)}}
                            </span>
                        </td>
                        <td style="padding: 1em; border-bottom: 1px solid #dee2e6; text-align: right;">
                            <span style="font-weight: 700; color: #28a745;">{{formatCurrency(product.totalRevenue)}}</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Tabla: Clientes que M치s Compraron -->
<div class="card mb-4" *ngIf="livestreamData">
    <div class="card-body">
        <h2 class="card-title mb-3">Clientes que M치s Compraron</h2>
        
        <div *ngIf="livestreamData.topCustomers.length === 0" style="text-align: center; padding: 2em; color: #6C757D;">
            No hay clientes registrados a칰n.
        </div>
        
        <div *ngIf="livestreamData.topCustomers.length > 0" style="overflow-x: auto;">
            <table class="table" style="min-width: 700px;">
                <thead style="background-color: #f8f9fa;">
                    <tr>
                        <th style="padding: 1em; border-bottom: 2px solid #dee2e6; width: 40px;">#</th>
                        <th style="padding: 1em; border-bottom: 2px solid #dee2e6;">Cliente</th>
                        <th style="padding: 1em; border-bottom: 2px solid #dee2e6; text-align: center;">Total Compras</th>
                        <th style="padding: 1em; border-bottom: 2px solid #dee2e6; text-align: center;">Productos</th>
                        <th style="padding: 1em; border-bottom: 2px solid #dee2e6; text-align: right;">Total Gastado</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let customer of livestreamData.topCustomers.slice(0, 10); let i = index">
                        <td style="padding: 1em; border-bottom: 1px solid #dee2e6;">
                            <div style="width: 30px; height: 30px; background-color: #667eea; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">
                                {{i + 1}}
                            </div>
                        </td>
                        <td style="padding: 1em; border-bottom: 1px solid #dee2e6;">
                            <div style="font-weight: 600; color: #1D2345;">{{customer.customerName}}</div>
                        </td>
                        <td style="padding: 1em; border-bottom: 1px solid #dee2e6; text-align: center;">
                            {{formatNumber(customer.totalPurchases)}}
                        </td>
                        <td style="padding: 1em; border-bottom: 1px solid #dee2e6; text-align: center;">
                            {{formatNumber(customer.productsCount)}}
                        </td>
                        <td style="padding: 1em; border-bottom: 1px solid #dee2e6; text-align: right;">
                            <span style="font-weight: 700; color: #28a745;">{{formatCurrency(customer.totalSpent)}}</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Gr치ficos por Atributo -->
<div class="card mb-4" *ngIf="livestreamData && getAttributeKeys().length > 0">
    <div class="card-body">
        <h2 class="card-title mb-3">Distribuci칩n por Atributos</h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2em;">
            <div *ngFor="let attributeName of getAttributeKeys()" style="padding: 1.5em; border: 1px solid #dee2e6; border-radius: 12px;">
                <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1em; color: #1D2345; text-align: center;">
                    {{attributeName}}
                </h3>
                
                <!-- Lista de valores con barras -->
                <div *ngFor="let item of getAttributeValues(attributeName); let i = index" style="margin-bottom: 1em;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25em;">
                        <span style="font-size: 0.875rem; color: #6C757D;">{{item.value}}</span>
                        <span style="font-size: 0.875rem; font-weight: 600; color: #1D2345;">{{item.percentage.toFixed(1)}}%</span>
                    </div>
                    
                    <!-- Barra de progreso -->
                    <div style="width: 100%; background-color: #e9ecef; border-radius: 10px; height: 20px; overflow: hidden; position: relative;">
                        <div [style.width.%]="item.percentage"
                             [style.background-color]="getColorForIndex(i)"
                             style="height: 100%; transition: width 0.3s ease;">
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 0.25em;">
                        <span style="font-size: 0.75rem; color: #6C757D;">Cantidad: {{formatNumber(item.count)}}</span>
                        <span style="font-size: 0.75rem; color: #6C757D;">Revenue: {{formatCurrency(item.revenue)}}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div *ngIf="!livestreamData" style="text-align: center; padding: 3em; color: #6C757D;">
    Cargando informaci칩n de productos y clientes...
</div>